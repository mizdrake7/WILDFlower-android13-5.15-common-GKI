<?xml version="1.0" encoding="utf-8"?>
<!-- Copyright (C) 2025 The Android Open Source Project
SPDX-License-Identifier: GPL-2.0 OR Apache-2.0
-->
<!DOCTYPE configuration [
<!ENTITY ktest_dir "/data/selftests/arm64">
]>
<configuration description="kselftest">
    <option name="test-suite-tag" value="kernel-test" />
    <target_preparer class="com.android.tradefed.targetprep.RootTargetPreparer" />
    <target_preparer class="com.android.tradefed.targetprep.StopServicesSetup" />

    <object type="module_controller" class="com.android.tradefed.testtype.suite.module.KernelTestModuleController" >
        <option name="arch" value="arm64"/>
    </object>

    <target_preparer class="com.android.tradefed.targetprep.PushFilePreparer">
        <option name="cleanup" value="true" />
        <option name="push-file" key="selftests" value="/data/selftests" />
        <option name="skip-abi-filtering" value="true" />
        <option name="post-push" value='chmod -R 755 /data/selftests; find /data/selftests -type f | xargs grep -l -e "bin/sh" -e "bin/bash" | xargs sed -i -e "s?/bin/echo?echo?" -i -e "s?#!/bin/sh?#!/system/bin/sh?" -i -e "s?#!/bin/bash?#!/system/bin/sh?" || echo "There were no files to process"' />
    </target_preparer>

    <test class="com.android.tradefed.testtype.binary.KernelTargetTest" >
        <option name="exit-code-skip" value="4" />
        <option name="skip-binary-check" value="true" />
        <option name="ktap-result-parser-resolution" value="INDIVIDUAL_LEAVES" />
        <option name="test-command-line" key="kselftest_binderfs_binderfs_test" value="cd &ktest_dir;; ./kselftest_binderfs_binderfs_test" />
    </test>
</configuration>
